<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
  body { margin: 0; padding: 20px; background: #1a1a2e; font-family: -apple-system, sans-serif; }
  canvas { display: block; }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
</head>
<body>
<canvas id="chart" width="800" height="400"></canvas>
<script>
const params = new URLSearchParams(window.location.search);
const buy = parseInt(params.get('buy')) || 0;
const known = JSON.parse(params.get('known') || '[]');
const mins = JSON.parse(params.get('mins') || '[]');
const maxs = JSON.parse(params.get('maxs') || '[]');
const labels = ['Mon AM','Mon PM','Tue AM','Tue PM','Wed AM','Wed PM','Thu AM','Thu PM','Fri AM','Fri PM','Sat AM','Sat PM'];

const ctx = document.getElementById('chart').getContext('2d');

// Build datasets
const knownData = known.map(v => v === null ? null : v);
const rangeMin = mins.map((v, i) => known[i] !== null ? null : v);
const rangeMax = maxs.map((v, i) => known[i] !== null ? null : v);

new Chart(ctx, {
  type: 'line',
  data: {
    labels: labels,
    datasets: [
      {
        label: 'Max possible',
        data: maxs,
        borderColor: 'rgba(255, 99, 132, 0.3)',
        backgroundColor: 'rgba(255, 99, 132, 0.08)',
        fill: '+1',
        pointRadius: 0,
        borderWidth: 1,
        borderDash: [4, 4],
        tension: 0.3
      },
      {
        label: 'Min possible',
        data: mins,
        borderColor: 'rgba(255, 99, 132, 0.3)',
        backgroundColor: 'transparent',
        fill: false,
        pointRadius: 0,
        borderWidth: 1,
        borderDash: [4, 4],
        tension: 0.3
      },
      {
        label: 'Known prices',
        data: knownData,
        borderColor: '#00e676',
        backgroundColor: '#00e676',
        pointRadius: 6,
        pointHoverRadius: 8,
        borderWidth: 3,
        spanGaps: false,
        tension: 0.2
      },
      {
        label: 'Buy price',
        data: labels.map(() => buy),
        borderColor: 'rgba(255, 193, 7, 0.5)',
        borderWidth: 2,
        borderDash: [8, 4],
        pointRadius: 0,
        fill: false
      }
    ]
  },
  options: {
    responsive: false,
    animation: false,
    plugins: {
      title: {
        display: true,
        text: `ðŸ¥¬ Stalk Market â€” Buy: ${buy} bells`,
        color: '#e0e0e0',
        font: { size: 18, weight: 'bold' }
      },
      legend: {
        labels: { color: '#aaa', font: { size: 12 } }
      }
    },
    scales: {
      x: {
        ticks: { color: '#aaa', font: { size: 11 } },
        grid: { color: 'rgba(255,255,255,0.06)' }
      },
      y: {
        title: { display: true, text: 'Bells', color: '#aaa' },
        ticks: { color: '#aaa' },
        grid: { color: 'rgba(255,255,255,0.06)' },
        min: 0
      }
    }
  }
});

window.__chartReady = true;
</script>
</body>
</html>
